#
# Start at "2022-W25-Jun20-1218-24-CEST"
#
# Version information:
# European Spallation Source ERIC : iocsh (4.0.0-PID-10905)
#
# --->--> snip -->--> 
# Please Use Version and other environment variables
# in order to report or debug this shell
#
# HOSTDISPLAY=""
# WINDOWID=""
# PWD="/home/anderssandstrom/sources/ecmc_mtca_mrf_test/iocsh_real"
# USER="anderssandstrom"
# LOGNAME="anderssandstrom"
# EPICS_HOST_ARCH="linux-x86_64"
# EPICS_BASE="/epics/base-7.0.6.1"
# E3_REQUIRE_NAME="require"
# E3_REQUIRE_VERSION="4.0.0"
# E3_REQUIRE_LOCATION="/epics/base-7.0.6.1/require/4.0.0"
# E3_REQUIRE_BIN="/epics/base-7.0.6.1/require/4.0.0/bin"
# E3_REQUIRE_DB="/epics/base-7.0.6.1/require/4.0.0/db"
# E3_REQUIRE_DBD="/epics/base-7.0.6.1/require/4.0.0/dbd"
# E3_REQUIRE_INC="/epics/base-7.0.6.1/require/4.0.0/include"
# E3_REQUIRE_LIB="/epics/base-7.0.6.1/require/4.0.0/lib"
# EPICS_DRIVER_PATH="/epics/base-7.0.6.1/require/4.0.0/siteMods"
# EPICS_CA_AUTO_ADDR_LIST=""
# EPICS_CA_ADDR_LIST=""
# EPICS_PVA_AUTO_ADDR_LIST=""
# EPICS_PVA_ADDR_LIST=""
# PATH="/epics/base-7.0.6.1/require/4.0.0/bin:/epics/base-7.0.6.1/bin/linux-x86_64:/usr/condabin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/anderssandstrom/.local/bin:/home/anderssandstrom/bin"
# --->--> snip -->--> 
#
# Set REQUIRE_IOC for its internal PVs
epicsEnvSet REQUIRE_IOC "REQMOD:lab-mot-ctrl-cp-10905"
#
# Enable an exit subroutine for sotfioc
dbLoadRecords "/epics/base-7.0.6.1/db/softIocExit.db" "IOC=REQMOD:lab-mot-ctrl-cp-10905"
#
# Set E3_IOCSH_TOP for the absolute path where iocsh is executed.
epicsEnvSet E3_IOCSH_TOP "/home/anderssandstrom/sources/ecmc_mtca_mrf_test/iocsh_real"
#
# 
# Load require module, which has the version 4.0.0
# 
dlload /epics/base-7.0.6.1/require/4.0.0/lib/linux-x86_64/librequire.so
dbLoadDatabase /epics/base-7.0.6.1/require/4.0.0/dbd/require.dbd
require_registerRecordDeviceDriver
Loading module info records for require
# 
# Set E3_CMD_TOP for the absolute path where ecmc_lean_test.script exists
epicsEnvSet E3_CMD_TOP "/home/anderssandstrom/sources/ecmc_mtca_mrf_test/iocsh_real"
#
iocshLoad 'ecmc_lean_test.script',''
##############################################################################
## Initiation:
epicsEnvSet("IOC" ,"IOC_MTCA")
epicsEnvSet("ECMCCFG_INIT" ,"")  #Only run startup once (auto at PSI, need call at ESS), variable set to "#" in startup.cmd
epicsEnvSet("SCRIPTEXEC" ,"iocshLoad")
# Configure ecmc
require ecmccfg ruckig
Module ecmccfg version ruckig found in /home/anderssandstrom/sources/e3-ecmccfg/cellMods//base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/
Loading library /home/anderssandstrom/sources/e3-ecmccfg/cellMods//base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/lib/linux-x86_64/libecmccfg.so
Loaded ecmccfg version ruckig
Loading dbd file /home/anderssandstrom/sources/e3-ecmccfg/cellMods//base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/dbd/ecmccfg.dbd
Calling function ecmccfg_registerRecordDeviceDriver
Loading module info records for ecmccfg
require mcoreutils
Module mcoreutils version 1.2.2+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/mcoreutils/1.2.2+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/mcoreutils/1.2.2+0/lib/linux-x86_64/libmcoreutils.so
Loaded mcoreutils version 1.2.2+0
Loading dbd file /epics/base-7.0.6.1/require/4.0.0/siteMods/mcoreutils/1.2.2+0/dbd/mcoreutils.dbd
Calling function mcoreutils_registerRecordDeviceDriver
MCoreUtils version 1.2.2+0
MCoreUtils: Read 0 thread rule(s) from /etc/rtrules
MCoreUtils: Read 0 thread rule(s) from /home/anderssandstrom/.rtrules
Loading module info records for mcoreutils
mcoreThreadRuleAdd ecmc * * 1 ecmc_rt
# run module startup.cmd (only needed at ESS  PSI auto call at require)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/startup.cmd, "IOC=IOC_MTCA,ECMC_VER=ecmc_mrf,EC_RATE=1000"
#==============================================================================
# startup.cmd
on error halt
require ecmc        "ecmc_mrf"
Module ecmc version ecmc_mrf found in /home/anderssandstrom/sources/e3-ecmc/cellMods//base-7.0.6.1/require-4.0.0/ecmc/ecmc_mrf/
Module ecmc depends on asyn 4.42.0+0
Module asyn version 4.42.0+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/asyn/4.42.0+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/asyn/4.42.0+0/lib/linux-x86_64/libasyn.so
Loaded asyn version 4.42.0+0
Loading dbd file /epics/base-7.0.6.1/require/4.0.0/siteMods/asyn/4.42.0+0/dbd/asyn.dbd
Calling function asyn_registerRecordDeviceDriver
Loading module info records for asyn
Module ecmc depends on exprtk 1.2.1+0
Module exprtk version 1.2.1+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/exprtk/1.2.1+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/exprtk/1.2.1+0/lib/linux-x86_64/libexprtk.so
Loaded exprtk version 1.2.1+0
exprtk has no dbd file
Loading module info records for exprtk
Module ecmc depends on motor 7.0.7+0
Module motor version 7.0.7+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/motor/7.0.7+0/
Module motor depends on asyn 4.42.0+0
Module asyn version 4.42.0+0 already loaded
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/motor/7.0.7+0/lib/linux-x86_64/libmotor.so
Loaded motor version 7.0.7+0
Loading dbd file /epics/base-7.0.6.1/require/4.0.0/siteMods/motor/7.0.7+0/dbd/motor.dbd
Calling function motor_registerRecordDeviceDriver
Loading module info records for motor
Module ecmc depends on ruckig 1.0.0+0
Module ruckig version 1.0.0+0 found in /epics/base-7.0.6.1/require/4.0.0/siteMods/ruckig/1.0.0+0/
Loading library /epics/base-7.0.6.1/require/4.0.0/siteMods/ruckig/1.0.0+0/lib/linux-x86_64/libruckig.so
Loaded ruckig version 1.0.0+0
ruckig has no dbd file
Loading module info records for ruckig
Loading library /home/anderssandstrom/sources/e3-ecmc/cellMods//base-7.0.6.1/require-4.0.0/ecmc/ecmc_mrf/lib/linux-x86_64/libecmc.so
Loaded ecmc version ecmc_mrf
Loading dbd file /home/anderssandstrom/sources/e3-ecmc/cellMods//base-7.0.6.1/require-4.0.0/ecmc/ecmc_mrf/dbd/ecmc.dbd
Calling function ecmc_registerRecordDeviceDriver
Loading module info records for ecmc
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'ecmcMotorRecord'='EthercatMC'", "require  EthercatMC 3.0.2 # Using EthercatMC motor record support.","# Using ecmcMotorRecord motor record support.")
# Using ecmcMotorRecord motor record support.
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_CONFIG_ROOT",     "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/")
epicsEnvSet("ECMC_CONFIG_DB",       "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/db/")
epicsEnvSet("SCRIPTEXEC",           "iocshLoad")
epicsEnvSet("SM_PREFIX",            "IOC_MTCA:")    # colon added since IOC is _not_ PREFIX
epicsEnvSet("ECMC_PROC_HOOK",       "")
epicsEnvSet(ECMC_MODE, FULL)
ecmcEpicsEnvSetCalcTernary(ECMC_SUPPORT_MOTION, "'FULL'!='DAQ'","","# MODE == DAQ, DISABLING MOTION.")
epicsEnvShow(ECMC_SUPPORT_MOTION)
ECMC_SUPPORT_MOTION=
ecmcEpicsEnvSetCalcTernary(ECMC_USE_MOTOR_RECORD, "'FULL'=='FULL'","","# MODE != FULL, DISABLING MOTOR RECORD.")
epicsEnvShow(ECMC_USE_MOTOR_RECORD)
ECMC_USE_MOTOR_RECORD=
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/initAll.cmd",1)
iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/initAll.cmd"
#==============================================================================
# initAll.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/init.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/init.cmd
#==============================================================================
# init.cmd
epicsEnvSet("ECMC_ASYN_TIMEOUT",      1)                   # Asyn timeout
epicsEnvSet("ECMC_ASYN_ADDR",         0)                   # Asyn Address
epicsEnvSet("ECMC_MOTOR_PORT",        "NOT SET")
epicsEnvSet("ECMC_ASYN_PORT",         "NOT SET")
epicsEnvSet("ECMC_PREFIX",            "NOT SET")
epicsEnvSet("ECMC_GEN_EC_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_GEN_AX_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_EC_AXIS_HEALTH",    "NOT SET")
epicsEnvSet("ECMC_PLC_SAMPLE_RATE_MS", "NOT SET")
epicsEnvSet("ECMC_TSE",               -2)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/initAxis.cmd",1)
iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/initAxis.cmd"
#==============================================================================
# initAxis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_unset.cmd",1)
iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_unset.cmd"
#==============================================================================
# ecmc_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_CNTRL_KP)
epicsEnvUnset(ECMC_CNTRL_KI)
epicsEnvUnset(ECMC_CNTRL_KD)
epicsEnvUnset(ECMC_CNTRL_KFF)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCHPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCH_CONTROL)
epicsEnvUnset(ECMC_EC_ENC_LATCH_STATUS)
epicsEnvUnset(ECMC_HOME_LATCH_COUNT_OFFSET)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_DRV_CONTROL)
epicsEnvUnset(ECMC_EC_DRV_STATUS)
epicsEnvUnset(ECMC_EC_DRV_VELOCITY)
epicsEnvUnset(ECMC_EC_DRV_BRAKE)
epicsEnvUnset(ECMC_EC_DRV_REDUCE_TORQUE)
epicsEnvUnset(ECMC_EC_DRV_RESET)
epicsEnvUnset(ECMC_EC_DRV_ALARM_0)
epicsEnvUnset(ECMC_EC_DRV_ALARM_1)
epicsEnvUnset(ECMC_EC_DRV_ALARM_2)
epicsEnvUnset(ECMC_EC_DRV_WARNING)
epicsEnvUnset(ECMC_DRV_SCALE_DENOM)
epicsEnvUnset(ECMC_DRV_SCALE_NUM)
epicsEnvUnset(ECMC_DRV_BRAKE_OPEN_DLY_TIME)
epicsEnvUnset(ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_sync_unset.cmd",1)
iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_sync_unset.cmd"
#============================================================================2022/06/20 12:18:24.448 
ECMC Initializes.............
2022/06/20 12:18:24.448 ESS Open Source EtherCAT Motion Control Epics Module2022/06/20 12:18:24.448 
Mode: Configuration
2022/06/20 12:18:24.448 OK
2022/06/20 12:18:24.448 OK
2022/06/20 12:18:24.448 OK
2022/06/20 12:18:24.451 OK
2022/06/20 12:18:24.456 OK
2022/06/20 12:18:24.456 OK
==
# ecmc_axis_sync_unset.cmd
epicsEnvUnset(ECMC_CMD_FRM_OTHER_PLC_ENABLE)
epicsEnvUnset(ECMC_CMD_AXIS_PLC_ENABLE)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_1)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_2)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_3)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_4)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_5)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_6)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_7)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_8)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_9)
epicsEnvUnset(ECMC_AXIS_EXPR_LINE_10)
epicsEnvUnset(ECMC_ENC_VELO_FILT_SIZE)
epicsEnvUnset(ECMC_ENC_VELO_FILT_ENABLE)
epicsEnvUnset(ECMC_ENC_SOURCE)
epicsEnvUnset(ECMC_TRAJ_VELO_FILT_SIZE)
epicsEnvUnset(ECMC_TRAJ_VELO_FILT_ENABLE)
epicsEnvUnset(ECMC_TRAJ_SOURCE)
epicsEnvSet("ECMC_EGU",               "mm")
epicsEnvSet("ECMC_PREC",              3)
epicsEnvSet("ECMC_AXISFIELDINIT",     "")                  # Extra field init to motor record
epicsEnvSet("ECMC_AXISCONFIG",        "")                  # Extra parameters to driver
############################################################
############# ASYN Configuration:
epicsEnvSet("ECMC_MOTOR_PORT"     "MCU1")
epicsEnvSet("ECMC_ASYN_PORT"      "MC_CPU1")
epicsEnvSet("ECMC_PREFIX"         "IOC_MTCA:")
ecmcAsynPortDriverConfigure(MC_CPU1,1000,0,0,100)
ecmcAsynPortDriverConfigure: portName = MC_CPU1, paramTableSize = 1000, disableAutoConnect = 0, priority = 0, defaultSampleRateMS = 100.000000
asynOctetSetOutputEos(MC_CPU1, -1, ";\n")
asynOctetSetInputEos(MC_CPU1, -1, ";\n")
asynSetTraceMask(MC_CPU1, -1, 0x41)
asynSetTraceIOMask(MC_CPU1, -1, 6)
asynSetTraceInfoMask(MC_CPU1, -1, 1)
ecmcMotorRecordCreateController(MCU1, MC_CPU1, "64", 200, 1000, "")
############################################################
############# Misc settings:
# Disable function call trace printouts
ecmcConfigOrDie "Cfg.SetEnableFuncCallDiag(0)"
# Disable on change printouts from objects (enable for easy logging)
ecmcConfigOrDie "Cfg.SetTraceMaskBit(15,0)"
# Choose to generate EPICS-records for EtherCAT-entries
# (For records use ECMC_GEN_EC_RECORDS="-records" otherwise ECMC_GEN_EC_RECORDS="")
epicsEnvSet("ECMC_GEN_EC_RECORDS",          "-records")
# Choose to generate EPICS-records for ax-entries (PosAct, SetPos,..)
# (For records use ECMC_GEN_AX_RECORDS="-records" otherwise ECMC_GEN_AX_RECORDS="")
epicsEnvSet("ECMC_GEN_AX_RECORDS",          "-records")
# suffix for pva enabled scripts, templates and substitutions
ecmcEpicsEnvSetCalcTernary(ECMC_PVA, "0", "Pva","")
# Set EtherCAT frequency (defaults to 1000)
ecmcConfigOrDie "Cfg.SetSampleRate(1000)"
epicsEnvSet("ECMC_EC_SAMPLE_RATE" ,   1000)
ecmcEpicsEnvSetCalc("ECMC_EC_SAMPLE_RATE_MS" ,1000/1000)
# Update records in 10ms (100Hz) for FULL MODE and in EC_RATE for DAQ mode
ecmcEpicsEnvSetCalcTernary(ECMC_SAMPLE_RATE_MS, "'FULL'=='DAQ'","1","10")
epicsEnvSet("ECMC_P_SCRIPT",        "mXsXXX")
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addMaster.cmd",1)
 iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addMaster.cmd", "MASTER_ID=0"
#===============================================================================
# addMaster.cfg
epicsEnvSet("ECMC_EC_MASTER_ID"          "0")
# Claim master
ecmcConfigOrDie "Cfg.EcSetMaster(0)"
epicsEnvSet("ECMC_EC_MASTER_ID" ,0)
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_MTCA/EcMaster_0/")
system "mkdir -p /tmp/IOC_MTCA/EcMaster_0/"
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_MTCA/EcMaster_0/")
system "mkdir -p /tmp/IOC_MTCA/EcMaster_0/"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/setDiagnostics.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/setDiagnostics.cmd
#==============================================================================
# setDiagnostics.cmd
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
ecmcConfigOrDie "Cfg.EcSetDomainFaile2022/06/20 12:18:24.456 OK
2022/06/20 12:18:24.457 OK
2022/06/20 12:18:24.458 OK
2022/06/20 12:18:24.458 OK
2022/06/20 12:18:24.458 OK
2022/06/20 12:18:24.458 OK
2022/06/20 12:18:24.458 OK
2022/06/20 12:18:24.458 OK
2022/06/20 12:18:24.458 OK
2022/06/20 12:18:24.458 OK
dCyclesLimit(100)"
epicsEnvSet("ECMCCFG_INIT" ,"#")
# Note NELM equals oversampling factor in this case. Use +-320mv Config file for all 4 channels
epicsEnvSet("NELM",              "20")
epicsEnvSet("ECMC_EC_SLAVE_NUM",              "2")
epicsEnvSet("ECMC_SAMPLE_RATE_MS", 0)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addSlave.cmd, "SLAVE_ID=2, HW_DESC=EL1252"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "2")
epicsEnvSet("HW_DESC",            "EL1252")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmcEL1252.cmd",1)
iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmcEL1252.cmd" "NELM=20"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1252")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x04e43052")
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(SLAVE_VERIFY, "0==0","","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,2,0x2,0x04e43052)"
ecmcEpicsEnvSetCalcTernary(SLAVE_RESET, "0>0","","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcEpicsEnvSetCalcTernary(SLAVE_FW, "0>0","","#- ")
epicsEnvUnset(SLAVE_VERIFY)
epicsEnvUnset(SLAVE_RESET)
epicsEnvUnset(SLAVE_FW)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmcEX1002.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x04e43052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x04e43052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xae,U8,status01)"
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xaf,U8,status02)"
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb0,U64,timestampLatchPositive01)"
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb8,U64,timestampLatchNegative01)"
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc0,U64,timestampLatchPositive02)"
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc8,U64,timestampLatchNegative02)"
# deduce what the prefix should be
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmcmXsXXX.cmd",1)
iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL1252"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "2","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_MTCA:m0s002")
epicsEnvSet("ECMC_P",            "IOC_MTCA:m0s002-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1252.substitutions,ECMC_P=IOC_MTCA:m0s002-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1252.substitutions,1,1)
dbLoadTemplate(ecmcEL1252.substitutions,"ECMC_P=IOC_MTCA:m0s002-,ECMC_G=IOC_MTCA:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL1252,T_SMP_MS=0,TSE=-2,NELM=20")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_MTCA:m0s002-,ECMC_G=IOC_MTCA:m0s002"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmc2022/06/20 12:18:24.461 OK
2022/06/20 12:18:24.461 OK
2022/06/20 12:18:24.463 OK
EcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_MTCA:m0s002-,ECMC_G=IOC_MTCA:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL1252,T_SMP_MS=0,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "2+1","%d")
epicsEnvSet("ECMC_SAMPLE_RATE_MS", 10)
#Apply hardware configuration
ecmcConfigOrDie "Cfg.EcApplyConfig(1)"
# Use CLOCK_REALTIME
ecmcConfigOrDie "Cfg.EcUseClockRealtime(1)"
ecmcConfigOrDie "Cfg.EcSelectReferenceDC(0,2)"
epicsEnvSet("DEV",      "IOC_MTCA")
epicsEnvSet("ID",       "1")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=1)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis1")
epicsEnvSet("ECMC_R",                     "Axis1-")
epicsEnvSet("ECMC_AXIS_NO",               "1")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (1)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting 2022/06/20 12:18:24.466 OK
2022/06/20 12:18:24.466 OK
2022/06/20 12:18:24.466 OK
2022/06/20 12:18:24.466 OK
2022/06/20 12:18:24.466 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.467 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
2022/06/20 12:18:24.468 OK
is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(1,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(1,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(1, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(1, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(1,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(1,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(1,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(1,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(1,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(1,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax1.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(1,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(1,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(1,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(1,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(1,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(1,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(1,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(1,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(1,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax1.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax1.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax1.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax1.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(1,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(1,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(1,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(1,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(1,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(1,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(1,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(1,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(1,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(1,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(1,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(1,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(1,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(1,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(1,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(1,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(1,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(1, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(1, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e32022/06/20 12:18:24.468 ecmcMotorRecord:: setIntegerParam(1 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.468 ecmcMotorRecord:: setDoubleParam(1 motorPowerOnDelay_)=6
2022/06/20 12:18:24.468 ecmcMotorRecord:: setDoubleParam(1 motorPowerOffDelay_=-1
2022/06/20 12:18:24.468 ecmcMotorRecord:: connected(1)
2022/06/20 12:18:24.468 ecmcMotorRecord:: initialPoll(1) status=0
-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "1", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1, DESC=MCU1025 Center Position (1), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis1,AXIS_NO=1,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis1,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "2")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=2)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis2")
epicsEnvSet("ECMC_R",                     "Axis2-")
epicsEnvSet("ECMC_AXIS_NO",               "2")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (2)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnv2022/06/20 12:18:24.473 OK
2022/06/20 12:18:24.473 OK
2022/06/20 12:18:24.473 OK
2022/06/20 12:18:24.473 OK
2022/06/20 12:18:24.473 OK
Set("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(2,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(2,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(2, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(2, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_S2022/06/20 12:18:24.474 OK
2022/06/20 12:18:24.474 OK
2022/06/20 12:18:24.474 OK
2022/06/20 12:18:24.474 OK
2022/06/20 12:18:24.474 OK
2022/06/20 12:18:24.474 OK
2022/06/20 12:18:24.474 OK
2022/06/20 12:18:24.474 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.475 OK
2022/06/20 12:18:24.476 OK
2022/06/20 12:18:24.476 ecmcMotorRecord:: setIntegerParam(2 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.476 ecmcMotorRecord:: setDoubleParam(2 motorPowerOnDelay_)=6
2022/06/20 12:18:24.476 ecmcMotorRecord:: setDoubleParam(2 motorPowerOffDelay_=-1
2022/06/20 12:18:24.476 ecmcMotorRecord:: connected(2)
2022/06/20 12:18:24.476 ecmcMotorRecord:: initialPoll(2) status=0
TR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(2,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(2,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(2,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(2,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(2,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(2,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax2.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(2,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(2,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(2,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(2,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(2,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(2,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(2,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(2,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(2,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax2.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax2.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax2.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax2.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax2.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(2,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(2,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(2,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(2,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(2,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(2,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(2,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(2,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(2,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(2,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(2,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(2,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(2,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(2,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(2,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(2,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(2,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(2, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(2, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "2", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis2, MOTOR_PORT=MCU1, AXIS_NO=2, DESC=MCU1025 Center Position (2), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis2, MOTOR_PORT=MCU1, AXIS_NO=2,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis2,AXIS_NO=2,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis2,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "3")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=3)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis3")
epicsEnvSet("ECMC_R",                     "Axis3-")
epicsEnvSet("ECMC_AXIS_NO",               "3")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (3)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccf2022/06/20 12:18:24.481 OK
2022/06/20 12:18:24.481 OK
2022/06/20 12:18:24.481 OK
2022/06/20 12:18:24.481 OK
2022/06/20 12:18:24.481 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
g/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(3,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(3,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(3, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(3, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(3,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(3,0)"
ecmcConfigOrDie "Cfg.S2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.482 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 OK
2022/06/20 12:18:24.483 ecmcMotorRecord:: setIntegerParam(3 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.483 ecmcMotorRecord:: setDoubleParam(3 motorPowerOnDelay_)=6
2022/06/20 12:18:24.483 ecmcMotorRecord:: setDoubleParam(3 motorPowerOffDelay_=-1
2022/06/20 12:18:24.483 ecmcMotorRecord:: connected(3)
2022/06/20 12:18:24.483 ecmcMotorRecord:: initialPoll(3) status=0
etAxisVel(3,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(3,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(3,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(3,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax3.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(3,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(3,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(3,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(3,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(3,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(3,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(3,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(3,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(3,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax3.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax3.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax3.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax3.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax3.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(3,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(3,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(3,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(3,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(3,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(3,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(3,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(3,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(3,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(3,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(3,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(3,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(3,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(3,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(3,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(3,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(3,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(3, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(3, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "3", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis3, MOTOR_PORT=MCU1, AXIS_NO=3, DESC=MCU1025 Center Position (3), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis3, MOTOR_PORT=MCU1, AXIS_NO=3,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis3,AXIS_NO=3,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis3,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "4")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=4)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis4")
epicsEnvSet("ECMC_R",                     "Axis4-")
epicsEnvSet("ECMC_AXIS_NO",               "4")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (4)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cm2022/06/20 12:18:24.488 OK
2022/06/20 12:18:24.488 OK
2022/06/20 12:18:24.488 OK
2022/06/20 12:18:24.488 OK
2022/06/20 12:18:24.488 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
d",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(4,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(4,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(4, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(4, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(4,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(4,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(4,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(4,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(4,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(4,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax4.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(4,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(4,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(4,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(4,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(4,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(4,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(4,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(4,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(4,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.enc.alarm0"2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.489 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 OK
2022/06/20 12:18:24.490 ecmcMotorRecord:: setIntegerParam(4 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.490 ecmcMotorRecord:: setDoubleParam(4 motorPowerOnDelay_)=6
2022/06/20 12:18:24.490 ecmcMotorRecord:: setDoubleParam(4 motorPowerOffDelay_=-1
2022/06/20 12:18:24.490 ecmcMotorRecord:: connected(4)
2022/06/20 12:18:24.490 ecmcMotorRecord:: initialPoll(4) status=0
)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax4.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax4.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax4.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax4.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax4.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(4,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(4,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(4,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(4,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(4,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(4,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(4,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(4,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(4,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(4,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(4,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(4,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(4,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(4,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(4,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(4,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(4,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(4, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(4, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "4", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis4, MOTOR_PORT=MCU1, AXIS_NO=4, DESC=MCU1025 Center Position (4), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis4, MOTOR_PORT=MCU1, AXIS_NO=4,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis4,AXIS_NO=4,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis4,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "5")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=5)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis5")
epicsEnvSet("ECMC_R",                     "Axis5-")
epicsEnvSet("ECMC_AXIS_NO",               "5")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (5)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcEx2022/06/20 12:18:24.495 OK
2022/06/20 12:18:24.495 OK
2022/06/20 12:18:24.495 OK
2022/06/20 12:18:24.495 OK
2022/06/20 12:18:24.495 OK
2022/06/20 12:18:24.496 OK
2022/06/20 12:18:24.496 OK
2022/06/20 12:18:24.496 OK
2022/06/20 12:18:24.496 OK
2022/06/20 12:18:24.496 OK
2022/06/20 12:18:24.496 OK
2022/06/20 12:18:24.496 OK
2022/06/20 12:18:24.496 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
it Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(5,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(5,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(5, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(5, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(5,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(5,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(5,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(5,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(5,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(5,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax5.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(5,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(5,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(5,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(5,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(5,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(5,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(5,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(5,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(5,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax5.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax5.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax5.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax5.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax5.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(5,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(5,1002022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.497 OK
2022/06/20 12:18:24.498 ecmcMotorRecord:: setIntegerParam(5 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.498 ecmcMotorRecord:: setDoubleParam(5 motorPowerOnDelay_)=6
2022/06/20 12:18:24.498 ecmcMotorRecord:: setDoubleParam(5 motorPowerOffDelay_=-1
2022/06/20 12:18:24.498 ecmcMotorRecord:: connected(5)
2022/06/20 12:18:24.498 ecmcMotorRecord:: initialPoll(5) status=0
)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(5,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(5,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(5,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(5,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(5,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(5,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(5,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(5,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(5,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(5,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(5,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(5,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(5,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(5,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(5,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(5, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(5, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "5", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis5, MOTOR_PORT=MCU1, AXIS_NO=5, DESC=MCU1025 Center Position (5), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis5, MOTOR_PORT=MCU1, AXIS_NO=5,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis5,AXIS_NO=5,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis5,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "6")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=6)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis6")
epicsEnvSet("ECMC_R",                     "Axis6-")
epicsEnvSet("ECMC_AXIS_NO",               "6")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (6)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad 2022/06/20 12:18:24.503 OK
2022/06/20 12:18:24.503 OK
2022/06/20 12:18:24.503 OK
2022/06/20 12:18:24.503 OK
2022/06/20 12:18:24.503 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.504 OK
2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 OK
/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(6,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(6,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(6, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(6, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(6,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(6,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(6,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(6,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(6,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(6,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax6.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(6,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(6,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(6,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(6,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(6,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(6,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(6,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(6,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(6,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax6.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax6.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax6.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax6.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax6.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(6,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(6,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(6,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(6,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(6,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(6,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(6,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(6,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(6,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(6,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(6,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(6,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(6,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(6,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(6,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(6,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(6,0.0)2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 OK
2022/06/20 12:18:24.505 ecmcMotorRecord:: setIntegerParam(6 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.505 ecmcMotorRecord:: setDoubleParam(6 motorPowerOnDelay_)=6
2022/06/20 12:18:24.505 ecmcMotorRecord:: setDoubleParam(6 motorPowerOffDelay_=-1
2022/06/20 12:18:24.505 ecmcMotorRecord:: connected(6)
2022/06/20 12:18:24.505 ecmcMotorRecord:: initialPoll(6) status=0
"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(6, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(6, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "6", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis6, MOTOR_PORT=MCU1, AXIS_NO=6, DESC=MCU1025 Center Position (6), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis6, MOTOR_PORT=MCU1, AXIS_NO=6,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis6,AXIS_NO=6,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis6,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "7")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=7)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis7")
epicsEnvSet("ECMC_R",                     "Axis7-")
epicsEnvSet("ECMC_AXIS_NO",               "7")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (7)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat ent2022/06/20 12:18:24.510 OK
2022/06/20 12:18:24.510 OK
2022/06/20 12:18:24.510 OK
2022/06/20 12:18:24.510 OK
2022/06/20 12:18:24.510 OK
ry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(7,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(7,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(7, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(7, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.511 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 OK
2022/06/20 12:18:24.512 ecmcMotorRecord:: setIntegerParam(7 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.512 ecmcMotorRecord:: setDoubleParam(7 motorPowerOnDelay_)=6
2022/06/20 12:18:24.512 ecmcMotorRecord:: setDoubleParam(7 motorPowerOffDelay_=-1
2022/06/20 12:18:24.512 ecmcMotorRecord:: connected(7)
2022/06/20 12:18:24.512 ecmcMotorRecord:: initialPoll(7) status=0
0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(7,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(7,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(7,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(7,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(7,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(7,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax7.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(7,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(7,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(7,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(7,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(7,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(7,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(7,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(7,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(7,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax7.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax7.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax7.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax7.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax7.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(7,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(7,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(7,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(7,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(7,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(7,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(7,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(7,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(7,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(7,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(7,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(7,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(7,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(7,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(7,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(7,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(7,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(7, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(7, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "7", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis7, MOTOR_PORT=MCU1, AXIS_NO=7, DESC=MCU1025 Center Position (7), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis7, MOTOR_PORT=MCU1, AXIS_NO=7,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis7,AXIS_NO=7,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis7,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "8")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=8)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis8")
epicsEnvSet("ECMC_R",                     "Axis8-")
epicsEnvSet("ECMC_AXIS_NO",               "8")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (8)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/c2022/06/20 12:18:24.517 OK
2022/06/20 12:18:24.517 OK
2022/06/20 12:18:24.517 OK
2022/06/20 12:18:24.517 OK
2022/06/20 12:18:24.517 OK
ellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(8,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(8,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(8, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(8, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcT2022/06/20 12:18:24.518 OK
2022/06/20 12:18:24.518 OK
2022/06/20 12:18:24.518 OK
2022/06/20 12:18:24.518 OK
2022/06/20 12:18:24.518 OK
2022/06/20 12:18:24.518 OK
2022/06/20 12:18:24.518 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.519 OK
2022/06/20 12:18:24.520 ecmcMotorRecord:: setIntegerParam(8 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.520 ecmcMotorRecord:: setDoubleParam(8 motorPowerOnDelay_)=6
2022/06/20 12:18:24.520 ecmcMotorRecord:: setDoubleParam(8 motorPowerOffDelay_=-1
2022/06/20 12:18:24.520 ecmcMotorRecord:: connected(8)
2022/06/20 12:18:24.520 ecmcMotorRecord:: initialPoll(8) status=0
ernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(8,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(8,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(8,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(8,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(8,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(8,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax8.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(8,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(8,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(8,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(8,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(8,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(8,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(8,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(8,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(8,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax8.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax8.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax8.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax8.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax8.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(8,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(8,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(8,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(8,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(8,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(8,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(8,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(8,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(8,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(8,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(8,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(8,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(8,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(8,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(8,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(8,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(8,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(8, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(8, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "8", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis8, MOTOR_PORT=MCU1, AXIS_NO=8, DESC=MCU1025 Center Position (8), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis8, MOTOR_PORT=MCU1, AXIS_NO=8,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis8,AXIS_NO=8,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis8,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "9")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=9)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis9")
epicsEnvSet("ECMC_R",                     "Axis9-")
epicsEnvSet("ECMC_AXIS_NO",               "9")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (9)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==================================================================2022/06/20 12:18:24.525 OK
2022/06/20 12:18:24.525 OK
2022/06/20 12:18:24.525 OK
2022/06/20 12:18:24.525 OK
2022/06/20 12:18:24.525 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
============
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(9,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(9,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(9, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(9, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(9,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(9,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(9,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(9,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(9,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(9,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax9.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(9,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(9,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(9,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(9,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(9,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(9,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(9,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(9,1)"
ecmcC2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.526 OK
2022/06/20 12:18:24.527 OK
2022/06/20 12:18:24.527 OK
2022/06/20 12:18:24.527 OK
2022/06/20 12:18:24.527 OK
2022/06/20 12:18:24.527 OK
2022/06/20 12:18:24.527 OK
2022/06/20 12:18:24.527 OK
2022/06/20 12:18:24.527 OK
2022/06/20 12:18:24.527 ecmcMotorRecord:: setIntegerParam(9 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.527 ecmcMotorRecord:: setDoubleParam(9 motorPowerOnDelay_)=6
2022/06/20 12:18:24.527 ecmcMotorRecord:: setDoubleParam(9 motorPowerOffDelay_=-1
2022/06/20 12:18:24.527 ecmcMotorRecord:: connected(9)
2022/06/20 12:18:24.527 ecmcMotorRecord:: initialPoll(9) status=0
onfigOrDie "Cfg.SetAxisEncPosFilterEnable(9,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax9.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax9.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax9.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax9.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax9.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(9,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(9,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(9,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(9,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(9,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(9,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(9,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(9,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(9,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(9,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(9,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(9,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(9,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(9,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(9,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(9,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(9,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(9, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(9, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "9", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis9, MOTOR_PORT=MCU1, AXIS_NO=9, DESC=MCU1025 Center Position (9), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis9, MOTOR_PORT=MCU1, AXIS_NO=9,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis9,AXIS_NO=9,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis9,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "10")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=10)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis10")
epicsEnvSet("ECMC_R",                     "Axis10-")
epicsEnvSet("ECMC_AXIS_NO",               "10")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (10)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#=========================2022/06/20 12:18:24.532 OK
2022/06/20 12:18:24.532 OK
2022/06/20 12:18:24.532 OK
2022/06/20 12:18:24.532 OK
2022/06/20 12:18:24.532 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
2022/06/20 12:18:24.533 OK
=====================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(10,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(10,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(10, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(10, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(10,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(10,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(10,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(10,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(10,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(10,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax10.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(10,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(10,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(10,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(10,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(10,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(10,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(10,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(10,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(10,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax10.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax10.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax10.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.02022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 OK
2022/06/20 12:18:24.534 ecmcMotorRecord:: setIntegerParam(10 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.534 ecmcMotorRecord:: setDoubleParam(10 motorPowerOnDelay_)=6
2022/06/20 12:18:24.534 ecmcMotorRecord:: setDoubleParam(10 motorPowerOffDelay_=-1
2022/06/20 12:18:24.534 ecmcMotorRecord:: connected(10)
2022/06/20 12:18:24.534 ecmcMotorRecord:: initialPoll(10) status=0
,"ax10.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax10.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(10,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(10,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(10,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(10,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(10,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(10,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(10,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(10,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(10,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(10,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(10,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(10,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(10,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(10,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(10,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(10,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(10,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(10, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(10, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "10", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis10, MOTOR_PORT=MCU1, AXIS_NO=10, DESC=MCU1025 Center Position (10), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis10, MOTOR_PORT=MCU1, AXIS_NO=10,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis10,AXIS_NO=10,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis10,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "11")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=11)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis11")
epicsEnvSet("ECMC_R",                     "Axis11-")
epicsEnvSet("ECMC_AXIS_NO",               "11")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (11)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error2022/06/20 12:18:24.539 OK
2022/06/20 12:18:24.539 OK
2022/06/20 12:18:24.539 OK
2022/06/20 12:18:24.539 OK
2022/06/20 12:18:24.539 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.540 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(11,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(11,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(11, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(11, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(11,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(11,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(11,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(11,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(11,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(11,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax11.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(11,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(11,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(11,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(11,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(11,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(11,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(11,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(11,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(11,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax11.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax11.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax11.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax11.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax11.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(11,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(11,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(11,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(11,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(11,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(11,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(11,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(11,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(11,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(11,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(11,0)"
ecmcConfigOrDie "Cfg.SetAxisEnabl2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 OK
2022/06/20 12:18:24.541 ecmcMotorRecord:: setIntegerParam(11 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.541 ecmcMotorRecord:: setDoubleParam(11 motorPowerOnDelay_)=6
2022/06/20 12:18:24.541 ecmcMotorRecord:: setDoubleParam(11 motorPowerOffDelay_=-1
2022/06/20 12:18:24.542 ecmcMotorRecord:: connected(11)
2022/06/20 12:18:24.542 ecmcMotorRecord:: initialPoll(11) status=0
eSoftLimitBwd(11,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(11,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(11,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(11,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(11,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(11,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(11, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(11, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "11", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis11, MOTOR_PORT=MCU1, AXIS_NO=11, DESC=MCU1025 Center Position (11), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis11, MOTOR_PORT=MCU1, AXIS_NO=11,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis11,AXIS_NO=11,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis11,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "12")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=12)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis12")
epicsEnvSet("ECMC_R",                     "Axis12-")
epicsEnvSet("ECMC_AXIS_NO",               "12")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (12)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie2022/06/20 12:18:24.547 OK
2022/06/20 12:18:24.547 OK
2022/06/20 12:18:24.547 OK
2022/06/20 12:18:24.547 OK
2022/06/20 12:18:24.547 OK
2022/06/20 12:18:24.547 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.548 OK
2022/06/20 12:18:24.549 OK
2022/06/20 12:18:24.549 OK
2022/06/20 12:18:24.549 OK
2022/06/20 12:18:24.549 OK
2022/06/20 12:18:24.549 OK
2022/06/20 12:18:24.549 OK
2022/06/20 12:18:24.549 OK
2022/06/20 12:18:24.549 OK
 "Cfg.CreateAxis(12,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(12,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(12, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(12, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(12,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(12,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(12,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(12,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(12,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(12,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax12.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(12,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(12,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(12,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(12,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(12,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(12,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(12,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(12,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(12,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax12.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax12.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax12.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax12.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax12.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(12,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(12,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(12,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(12,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(12,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(12,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(12,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(12,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(12,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(12,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(12,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(12,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(12,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(12,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(12,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(12,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(12,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(12, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(12, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#============================================================2022/06/20 12:18:24.549 ecmcMotorRecord:: setIntegerParam(12 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.549 ecmcMotorRecord:: setDoubleParam(12 motorPowerOnDelay_)=6
2022/06/20 12:18:24.549 ecmcMotorRecord:: setDoubleParam(12 motorPowerOffDelay_=-1
2022/06/20 12:18:24.549 ecmcMotorRecord:: connected(12)
2022/06/20 12:18:24.549 ecmcMotorRecord:: initialPoll(12) status=0
==================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "12", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis12, MOTOR_PORT=MCU1, AXIS_NO=12, DESC=MCU1025 Center Position (12), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis12, MOTOR_PORT=MCU1, AXIS_NO=12,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis12,AXIS_NO=12,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis12,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "13")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=13)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis13")
epicsEnvSet("ECMC_R",                     "Axis13-")
epicsEnvSet("ECMC_AXIS_NO",               "13")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (13)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL"2022/06/20 12:18:24.554 OK
2022/06/20 12:18:24.554 OK
2022/06/20 12:18:24.554 OK
2022/06/20 12:18:24.554 OK
2022/06/20 12:18:24.554 OK
,     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(13,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(13,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(13, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(13, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_E2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.555 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 OK
2022/06/20 12:18:24.556 ecmcMotorRecord:: setIntegerParam(13 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.556 ecmcMotorRecord:: setDoubleParam(13 motorPowerOnDelay_)=6
2022/06/20 12:18:24.556 ecmcMotorRecord:: setDoubleParam(13 motorPowerOffDelay_=-1
2022/06/20 12:18:24.556 ecmcMotorRecord:: connected(13)
2022/06/20 12:18:24.556 ecmcMotorRecord:: initialPoll(13) status=0
XE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(13,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(13,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(13,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(13,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(13,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(13,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax13.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(13,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(13,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(13,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(13,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(13,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(13,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(13,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(13,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(13,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax13.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax13.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax13.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax13.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax13.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(13,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(13,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(13,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(13,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(13,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(13,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(13,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(13,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(13,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(13,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(13,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(13,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(13,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(13,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(13,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(13,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(13,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(13, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(13, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "13", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis13, MOTOR_PORT=MCU1, AXIS_NO=13, DESC=MCU1025 Center Position (13), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis13, MOTOR_PORT=MCU1, AXIS_NO=13,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis13,AXIS_NO=13,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis13,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "14")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=14)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis14")
epicsEnvSet("ECMC_R",                     "Axis14-")
epicsEnvSet("ECMC_AXIS_NO",               "14")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (14)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='D2022/06/20 12:18:24.561 OK
2022/06/20 12:18:24.561 OK
2022/06/20 12:18:24.561 OK
2022/06/20 12:18:24.561 OK
2022/06/20 12:18:24.561 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
AQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(14,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(14,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(14, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(14, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(14,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(14,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(14,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(14,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(14,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(14,42022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.562 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 OK
2022/06/20 12:18:24.563 ecmcMotorRecord:: setIntegerParam(14 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.563 ecmcMotorRecord:: setDoubleParam(14 motorPowerOnDelay_)=6
2022/06/20 12:18:24.563 ecmcMotorRecord:: setDoubleParam(14 motorPowerOffDelay_=-1
2022/06/20 12:18:24.564 ecmcMotorRecord:: connected(14)
2022/06/20 12:18:24.564 ecmcMotorRecord:: initialPoll(14) status=0
)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax14.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(14,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(14,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(14,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(14,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(14,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(14,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(14,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(14,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(14,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax14.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax14.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax14.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax14.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax14.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(14,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(14,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(14,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(14,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(14,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(14,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(14,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(14,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(14,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(14,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(14,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(14,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(14,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(14,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(14,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(14,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(14,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(14, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(14, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "14", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis14, MOTOR_PORT=MCU1, AXIS_NO=14, DESC=MCU1025 Center Position (14), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis14, MOTOR_PORT=MCU1, AXIS_NO=14,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis14,AXIS_NO=14,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis14,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "15")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=15)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis15")
epicsEnvSet("ECMC_R",                     "Axis15-")
epicsEnvSet("ECMC_AXIS_NO",               "15")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (15)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc2022/06/20 12:18:24.569 OK
2022/06/20 12:18:24.569 OK
2022/06/20 12:18:24.569 OK
2022/06/20 12:18:24.569 OK
2022/06/20 12:18:24.569 OK
2022/06/20 12:18:24.569 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(15,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(15,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax15.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(15, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(15, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(15,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(15,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(15,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(15,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(15,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(15,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax15.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(15,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(15,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(15,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(15,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(15,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(15,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(15,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(15,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(15,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax15.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax15.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax15.enc.alarm1")"
ecmcConfigOrDie "Cfg.Link2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.570 OK
2022/06/20 12:18:24.571 OK
2022/06/20 12:18:24.571 OK
2022/06/20 12:18:24.571 OK
2022/06/20 12:18:24.571 OK
2022/06/20 12:18:24.571 OK
2022/06/20 12:18:24.571 ecmcMotorRecord:: setIntegerParam(15 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.571 ecmcMotorRecord:: setDoubleParam(15 motorPowerOnDelay_)=6
2022/06/20 12:18:24.571 ecmcMotorRecord:: setDoubleParam(15 motorPowerOffDelay_=-1
2022/06/20 12:18:24.571 ecmcMotorRecord:: connected(15)
2022/06/20 12:18:24.571 ecmcMotorRecord:: initialPoll(15) status=0
EcEntryToObject(,"ax15.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax15.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax15.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax15.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax15.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax15.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax15.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax15.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax15.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(15,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(15,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(15,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(15,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(15,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(15,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(15,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(15,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(15,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(15,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(15,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(15,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(15,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(15,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(15,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(15,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(15,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(15, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(15, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "15", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis15, MOTOR_PORT=MCU1, AXIS_NO=15, DESC=MCU1025 Center Position (15), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis15, MOTOR_PORT=MCU1, AXIS_NO=15,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis15,AXIS_NO=15,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis15,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "16")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=16)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis16")
epicsEnvSet("ECMC_R",                     "Axis16-")
epicsEnvSet("ECMC_AXIS_NO",               "16")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (16)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_2022/06/20 12:18:24.576 OK
2022/06/20 12:18:24.576 OK
2022/06/20 12:18:24.576 OK
2022/06/20 12:18:24.576 OK
2022/06/20 12:18:24.576 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.577 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(16,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(16,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(16, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(16, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(16,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(16,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(16,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(16,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(16,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(16,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax16.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(16,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(16,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(16,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(16,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(16,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(16,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(16,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(16,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(16,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax16.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax16.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax16.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax16.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax16.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(16,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(16,100)"
ecmcConf2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 OK
2022/06/20 12:18:24.578 ecmcMotorRecord:: setIntegerParam(16 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.578 ecmcMotorRecord:: setDoubleParam(16 motorPowerOnDelay_)=6
2022/06/20 12:18:24.578 ecmcMotorRecord:: setDoubleParam(16 motorPowerOffDelay_=-1
2022/06/20 12:18:24.578 ecmcMotorRecord:: connected(16)
2022/06/20 12:18:24.578 ecmcMotorRecord:: initialPoll(16) status=0
igOrDie "Cfg.SetAxisMonEnableAtTargetMon(16,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(16,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(16,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(16,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(16,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(16,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(16,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(16,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(16,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(16,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(16,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(16,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(16,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(16,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(16,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(16, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(16, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "16", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis16, MOTOR_PORT=MCU1, AXIS_NO=16, DESC=MCU1025 Center Position (16), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis16, MOTOR_PORT=MCU1, AXIS_NO=16,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis16,AXIS_NO=16,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis16,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "17")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=17)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis17")
epicsEnvSet("ECMC_R",                     "Axis17-")
epicsEnvSet("ECMC_AXIS_NO",               "17")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (17)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarni2022/06/20 12:18:24.583 OK
2022/06/20 12:18:24.583 OK
2022/06/20 12:18:24.583 OK
2022/06/20 12:18:24.583 OK
2022/06/20 12:18:24.583 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.584 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
ng.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(17,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(17,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(17, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(17, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(17,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(17,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(17,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(17,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(17,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(17,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax17.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(17,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(17,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(17,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(17,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(17,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(17,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(17,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(17,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(17,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax17.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax17.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax17.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax17.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax17.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(17,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(17,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(17,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(17,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(17,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(17,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(17,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(17,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(17,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(17,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(17,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(17,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(17,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(17,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(17,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLat2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 OK
2022/06/20 12:18:24.585 ecmcMotorRecord:: setIntegerParam(17 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.585 ecmcMotorRecord:: setDoubleParam(17 motorPowerOnDelay_)=6
2022/06/20 12:18:24.585 ecmcMotorRecord:: setDoubleParam(17 motorPowerOffDelay_=-1
2022/06/20 12:18:24.586 ecmcMotorRecord:: connected(17)
2022/06/20 12:18:24.586 ecmcMotorRecord:: initialPoll(17) status=0
chCountOffset(17,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(17,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(17, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(17, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "17", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis17, MOTOR_PORT=MCU1, AXIS_NO=17, DESC=MCU1025 Center Position (17), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis17, MOTOR_PORT=MCU1, AXIS_NO=17,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis17,AXIS_NO=17,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis17,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "18")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=18)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis18")
epicsEnvSet("ECMC_R",                     "Axis18-")
epicsEnvSet("ECMC_AXIS_NO",               "18")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (18)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch i2022/06/20 12:18:24.591 OK
2022/06/20 12:18:24.591 OK
2022/06/20 12:18:24.591 OK
2022/06/20 12:18:24.591 OK
nput
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(18,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(18,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(18, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(18,2022/06/20 12:18:24.591 OK
2022/06/20 12:18:24.591 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.592 OK
2022/06/20 12:18:24.593 OK
2022/06/20 12:18:24.593 OK
2022/06/20 12:18:24.593 OK
2022/06/20 12:18:24.593 OK
2022/06/20 12:18:24.593 OK
2022/06/20 12:18:24.593 OK
2022/06/20 12:18:24.593 OK
2022/06/20 12:18:24.593 ecmcMotorRecord:: setIntegerParam(18 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.593 ecmcMotorRecord:: setDoubleParam(18 motorPowerOnDelay_)=6
2022/06/20 12:18:24.593 ecmcMotorRecord:: setDoubleParam(18 motorPowerOffDelay_=-1
2022/06/20 12:18:24.593 ecmcMotorRecord:: connected(18)
2022/06/20 12:18:24.593 ecmcMotorRecord:: initialPoll(18) status=0
 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(18,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(18,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(18,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(18,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(18,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(18,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax18.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(18,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(18,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(18,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(18,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(18,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(18,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(18,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(18,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(18,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax18.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax18.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax18.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax18.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax18.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(18,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(18,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(18,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(18,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(18,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(18,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(18,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(18,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(18,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(18,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(18,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(18,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(18,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(18,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(18,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(18,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(18,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(18, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(18, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "18", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis18, MOTOR_PORT=MCU1, AXIS_NO=18, DESC=MCU1025 Center Position (18), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis18, MOTOR_PORT=MCU1, AXIS_NO=18,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis18,AXIS_NO=18,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis18,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "19")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=19)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis19")
epicsEnvSet("ECMC_R",                     "Axis19-")
epicsEnvSet("ECMC_AXIS_NO",               "19")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (19)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100"2022/06/20 12:18:24.598 OK
2022/06/20 12:18:24.598 OK
2022/06/20 12:18:24.598 OK
2022/06/20 12:18:24.598 OK
2022/06/20 12:18:24.598 OK
)
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(19,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(19,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(19, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(19, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
################################2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.599 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 OK
2022/06/20 12:18:24.600 ecmcMotorRecord:: setIntegerParam(19 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.600 ecmcMotorRecord:: setDoubleParam(19 motorPowerOnDelay_)=6
2022/06/20 12:18:24.600 ecmcMotorRecord:: setDoubleParam(19 motorPowerOffDelay_=-1
2022/06/20 12:18:24.600 ecmcMotorRecord:: connected(19)
2022/06/20 12:18:24.600 ecmcMotorRecord:: initialPoll(19) status=0
#########################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(19,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(19,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(19,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(19,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(19,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(19,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax19.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(19,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(19,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(19,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(19,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(19,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(19,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(19,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(19,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(19,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax19.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax19.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax19.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax19.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax19.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(19,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(19,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(19,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(19,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(19,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(19,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(19,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(19,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(19,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(19,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(19,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(19,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(19,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(19,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(19,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(19,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(19,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(19, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(19, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "19", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis19, MOTOR_PORT=MCU1, AXIS_NO=19, DESC=MCU1025 Center Position (19), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis19, MOTOR_PORT=MCU1, AXIS_NO=19,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis19,AXIS_NO=19,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis19,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "20")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=20)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis20")
epicsEnvSet("ECMC_R",                     "Axis20-")
epicsEnvSet("ECMC_AXIS_NO",               "20")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (20)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_2022/06/20 12:18:24.605 OK
2022/06/20 12:18:24.605 OK
2022/06/20 12:18:24.605 OK
2022/06/20 12:18:24.605 OK
2022/06/20 12:18:24.605 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(20,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(20,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(20, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(20, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(20,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(20,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(20,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(20,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(20,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(20,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax20.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(20,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(20,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(20,1)"
ecm2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.606 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 OK
2022/06/20 12:18:24.607 ecmcMotorRecord:: setIntegerParam(20 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.607 ecmcMotorRecord:: setDoubleParam(20 motorPowerOnDelay_)=6
2022/06/20 12:18:24.607 ecmcMotorRecord:: setDoubleParam(20 motorPowerOffDelay_=-1
2022/06/20 12:18:24.607 ecmcMotorRecord:: connected(20)
2022/06/20 12:18:24.607 ecmcMotorRecord:: initialPoll(20) status=0
cConfigOrDie "Cfg.SetAxisEncBits(20,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(20,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(20,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(20,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(20,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(20,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax20.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax20.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax20.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax20.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax20.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(20,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(20,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(20,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(20,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(20,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(20,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(20,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(20,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(20,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(20,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(20,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(20,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(20,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(20,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(20,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(20,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(20,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(20, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(20, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "20", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis20, MOTOR_PORT=MCU1, AXIS_NO=20, DESC=MCU1025 Center Position (20), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis20, MOTOR_PORT=MCU1, AXIS_NO=20,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis20,AXIS_NO=20,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis20,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "21")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=21)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis21")
epicsEnvSet("ECMC_R",                     "Axis21-")
epicsEnvSet("ECMC_AXIS_NO",               "21")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (21)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/2022/06/20 12:18:24.612 OK
2022/06/20 12:18:24.612 OK
2022/06/20 12:18:24.613 OK
2022/06/20 12:18:24.613 OK
2022/06/20 12:18:24.613 OK
2022/06/20 12:18:24.613 OK
2022/06/20 12:18:24.613 OK
2022/06/20 12:18:24.613 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(21,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(21,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(21, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(21, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(21,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(21,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(21,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(21,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(21,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(21,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax21.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(21,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(21,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(21,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(21,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(21,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(21,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(21,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(21,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(21,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.enc.la2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.614 OK
2022/06/20 12:18:24.615 OK
2022/06/20 12:18:24.615 ecmcMotorRecord:: setIntegerParam(21 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.615 ecmcMotorRecord:: setDoubleParam(21 motorPowerOnDelay_)=6
2022/06/20 12:18:24.615 ecmcMotorRecord:: setDoubleParam(21 motorPowerOffDelay_=-1
2022/06/20 12:18:24.615 ecmcMotorRecord:: connected(21)
2022/06/20 12:18:24.615 ecmcMotorRecord:: initialPoll(21) status=0
tchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax21.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax21.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax21.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax21.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax21.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(21,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(21,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(21,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(21,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(21,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(21,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(21,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(21,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(21,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(21,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(21,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(21,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(21,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(21,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(21,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(21,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(21,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(21, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(21, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "21", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis21, MOTOR_PORT=MCU1, AXIS_NO=21, DESC=MCU1025 Center Position (21), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis21, MOTOR_PORT=MCU1, AXIS_NO=21,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis21,AXIS_NO=21,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis21,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "22")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=22)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis22")
epicsEnvSet("ECMC_R",                     "Axis22-")
epicsEnvSet("ECMC_AXIS_NO",               "22")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (22)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_E2022/06/20 12:18:24.620 OK
2022/06/20 12:18:24.620 OK
2022/06/20 12:18:24.620 OK
2022/06/20 12:18:24.620 OK
2022/06/20 12:18:24.620 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
2022/06/20 12:18:24.621 OK
NC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(22,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(22,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(22, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(22, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(22,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(22,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(22,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(22,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(22,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(22,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax22.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(22,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(22,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(22,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(22,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(22,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(22,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(22,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(22,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(22,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax22.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax22.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax22.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax22.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax22.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(22,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(22,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(22,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(22,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(22,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(22,0)"
ecmcConfigOrDie "C2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 OK
2022/06/20 12:18:24.622 ecmcMotorRecord:: setIntegerParam(22 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.622 ecmcMotorRecord:: setDoubleParam(22 motorPowerOnDelay_)=6
2022/06/20 12:18:24.622 ecmcMotorRecord:: setDoubleParam(22 motorPowerOffDelay_=-1
2022/06/20 12:18:24.622 ecmcMotorRecord:: connected(22)
2022/06/20 12:18:24.622 ecmcMotorRecord:: initialPoll(22) status=0
fg.SetAxisMonMaxVel(22,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(22,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(22,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(22,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(22,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(22,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(22,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(22,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(22,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(22,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(22,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(22, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(22, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "22", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis22, MOTOR_PORT=MCU1, AXIS_NO=22, DESC=MCU1025 Center Position (22), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis22, MOTOR_PORT=MCU1, AXIS_NO=22,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis22,AXIS_NO=22,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis22,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "23")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=23)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis23")
epicsEnvSet("ECMC_R",                     "Axis23-")
epicsEnvSet("ECMC_AXIS_NO",               "23")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (23)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be u2022/06/20 12:18:24.627 OK
2022/06/20 12:18:24.627 OK
2022/06/20 12:18:24.627 OK
2022/06/20 12:18:24.627 OK
2022/06/20 12:18:24.627 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.628 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
2022/06/20 12:18:24.629 OK
sed. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(23,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(23,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(23, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(23, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(23,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(23,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(23,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(23,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(23,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(23,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax23.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(23,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(23,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(23,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(23,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(23,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(23,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(23,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(23,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(23,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax23.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax23.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax23.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax23.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax23.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(23,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(23,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(23,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(23,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(23,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(23,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(23,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(23,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(23,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(23,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(23,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(23,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(23,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(23,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(23,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(23,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(23,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(23, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(23, 0)"
 ecmcFileExist("/home/ander2022/06/20 12:18:24.629 ecmcMotorRecord:: setIntegerParam(23 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.629 ecmcMotorRecord:: setDoubleParam(23 motorPowerOnDelay_)=6
2022/06/20 12:18:24.629 ecmcMotorRecord:: setDoubleParam(23 motorPowerOffDelay_=-1
2022/06/20 12:18:24.629 ecmcMotorRecord:: connected(23)
2022/06/20 12:18:24.629 ecmcMotorRecord:: initialPoll(23) status=0
ssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "23", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis23, MOTOR_PORT=MCU1, AXIS_NO=23, DESC=MCU1025 Center Position (23), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis23, MOTOR_PORT=MCU1, AXIS_NO=23,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis23,AXIS_NO=23,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis23,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "24")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=24)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis24")
epicsEnvSet("ECMC_R",                     "Axis24-")
epicsEnvSet("ECMC_AXIS_NO",               "24")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (24)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_S2022/06/20 12:18:24.634 OK
2022/06/20 12:18:24.634 OK
2022/06/20 12:18:24.634 OK
2022/06/20 12:18:24.635 OK
2022/06/20 12:18:24.635 OK
OFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(24,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(24,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(24, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(24, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.2022/06/20 12:18:24.635 OK
2022/06/20 12:18:24.635 OK
2022/06/20 12:18:24.635 OK
2022/06/20 12:18:24.635 OK
2022/06/20 12:18:24.635 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.636 OK
2022/06/20 12:18:24.637 OK
2022/06/20 12:18:24.637 OK
2022/06/20 12:18:24.637 OK
2022/06/20 12:18:24.637 ecmcMotorRecord:: setIntegerParam(24 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.637 ecmcMotorRecord:: setDoubleParam(24 motorPowerOnDelay_)=6
2022/06/20 12:18:24.637 ecmcMotorRecord:: setDoubleParam(24 motorPowerOffDelay_=-1
2022/06/20 12:18:24.637 ecmcMotorRecord:: connected(24)
2022/06/20 12:18:24.637 ecmcMotorRecord:: initialPoll(24) status=0
0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(24,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(24,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(24,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(24,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(24,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(24,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax24.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(24,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(24,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(24,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(24,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(24,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(24,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(24,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(24,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(24,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax24.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax24.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax24.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax24.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax24.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(24,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(24,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(24,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(24,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(24,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(24,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(24,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(24,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(24,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(24,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(24,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(24,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(24,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(24,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(24,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(24,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(24,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(24, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(24, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "24", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis24, MOTOR_PORT=MCU1, AXIS_NO=24, DESC=MCU1025 Center Position (24), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis24, MOTOR_PORT=MCU1, AXIS_NO=24,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis24,AXIS_NO=24,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis24,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "25")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=25)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis25")
epicsEnvSet("ECMC_R",                     "Axis25-")
epicsEnvSet("ECMC_AXIS_NO",               "25")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (25)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxi2022/06/20 12:18:24.642 OK
2022/06/20 12:18:24.642 OK
2022/06/20 12:18:24.642 OK
2022/06/20 12:18:24.642 OK
2022/06/20 12:18:24.642 OK
s.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(25,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(25,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(25, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(25, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcCon2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.643 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 OK
2022/06/20 12:18:24.644 ecmcMotorRecord:: setIntegerParam(25 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.644 ecmcMotorRecord:: setDoubleParam(25 motorPowerOnDelay_)=6
2022/06/20 12:18:24.644 ecmcMotorRecord:: setDoubleParam(25 motorPowerOffDelay_=-1
2022/06/20 12:18:24.644 ecmcMotorRecord:: connected(25)
2022/06/20 12:18:24.644 ecmcMotorRecord:: initialPoll(25) status=0
figOrDie "Cfg.SetAxisVelAccDecTime(25,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(25,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(25,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(25,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(25,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(25,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax25.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(25,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(25,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(25,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(25,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(25,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(25,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(25,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(25,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(25,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax25.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax25.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax25.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax25.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax25.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(25,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(25,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(25,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(25,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(25,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(25,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(25,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(25,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(25,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(25,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(25,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(25,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(25,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(25,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(25,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(25,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(25,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(25, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(25, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "25", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis25, MOTOR_PORT=MCU1, AXIS_NO=25, DESC=MCU1025 Center Position (25), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis25, MOTOR_PORT=MCU1, AXIS_NO=25,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis25,AXIS_NO=25,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis25,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "26")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=26)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis26")
epicsEnvSet("ECMC_R",                     "Axis26-")
epicsEnvSet("ECMC_AXIS_NO",               "26")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (26)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(1) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(1) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(2) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000005
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(2) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(2) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(3) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(3) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(3) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(4) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000006
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(4) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(4) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(5) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000003
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(5) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(5) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(6) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(6) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(6) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(7) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000004
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(7) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(7) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(8) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000005
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(8) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(8) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(9) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(9) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(9) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(10) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(10) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(10) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(11) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000003
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(11) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(11) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(12) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000005
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(12) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(12) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(13) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(13) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(13) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(14) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(14) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(14) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(15) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000005
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(15) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(15) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(16) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(16) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(16) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(17) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000003
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(17) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(17) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(18) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(18) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.648 ecmcMotorRecord:: poll(18) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(19) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(19) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(19) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(20) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(20) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(20) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(21) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(21) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(21) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(22) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(22) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(22) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(23) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(23) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(23) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(24) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(24) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(24) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(25) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(25) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.649 ecmcMotorRecord:: poll(25) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.649 OK
2022/06/20 12:18:24.649 OK
2022/06/20 12:18:24.649 OK
2022/06/20 12:18:24.649 OK
2022/06/20 12:18:24.649 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
2022/06/20 12:18:24.650 OK
================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(26,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(26,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(26, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(26, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(26,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(26,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(26,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(26,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(26,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(26,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax26.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(26,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(26,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(26,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(26,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(26,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(26,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(26,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPo2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 OK
2022/06/20 12:18:24.651 ecmcMotorRecord:: setIntegerParam(26 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.651 ecmcMotorRecord:: setDoubleParam(26 motorPowerOnDelay_)=6
2022/06/20 12:18:24.651 ecmcMotorRecord:: setDoubleParam(26 motorPowerOffDelay_=-1
2022/06/20 12:18:24.651 ecmcMotorRecord:: connected(26)
2022/06/20 12:18:24.651 ecmcMotorRecord:: initialPoll(26) status=0
sFilterSize(26,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(26,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax26.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax26.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax26.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax26.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax26.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(26,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(26,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(26,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(26,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(26,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(26,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(26,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(26,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(26,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(26,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(26,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(26,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(26,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(26,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(26,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(26,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(26,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(26, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(26, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "26", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis26, MOTOR_PORT=MCU1, AXIS_NO=26, DESC=MCU1025 Center Position (26), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis26, MOTOR_PORT=MCU1, AXIS_NO=26,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis26,AXIS_NO=26,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis26,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "27")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=27)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis27")
epicsEnvSet("ECMC_R",                     "Axis27-")
epicsEnvSet("ECMC_AXIS_NO",               "27")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (27)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',E2022/06/20 12:18:24.656 OK
2022/06/20 12:18:24.657 OK
2022/06/20 12:18:24.657 OK
2022/06/20 12:18:24.657 OK
2022/06/20 12:18:24.657 OK
2022/06/20 12:18:24.657 OK
2022/06/20 12:18:24.657 OK
2022/06/20 12:18:24.657 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
RROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(27,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(27,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(27, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(27, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(27,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(27,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(27,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(27,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(27,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(27,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax27.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(27,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(27,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(27,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(27,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(27,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(27,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(27,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(27,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(27,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax27.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax27.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax27.mon2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.658 OK
2022/06/20 12:18:24.659 OK
2022/06/20 12:18:24.659 OK
2022/06/20 12:18:24.659 OK
2022/06/20 12:18:24.659 ecmcMotorRecord:: setIntegerParam(27 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.659 ecmcMotorRecord:: setDoubleParam(27 motorPowerOnDelay_)=6
2022/06/20 12:18:24.659 ecmcMotorRecord:: setDoubleParam(27 motorPowerOffDelay_=-1
2022/06/20 12:18:24.659 ecmcMotorRecord:: connected(27)
2022/06/20 12:18:24.659 ecmcMotorRecord:: initialPoll(27) status=0
.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax27.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax27.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(27,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(27,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(27,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(27,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(27,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(27,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(27,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(27,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(27,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(27,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(27,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(27,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(27,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(27,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(27,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(27,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(27,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(27, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(27, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "27", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis27, MOTOR_PORT=MCU1, AXIS_NO=27, DESC=MCU1025 Center Position (27), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis27, MOTOR_PORT=MCU1, AXIS_NO=27,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis27,AXIS_NO=27,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis27,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "28")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=28)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis28")
epicsEnvSet("ECMC_R",                     "Axis28-")
epicsEnvSet("ECMC_AXIS_NO",               "28")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (28)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(2022/06/20 12:18:24.664 OK
2022/06/20 12:18:24.664 OK
2022/06/20 12:18:24.664 OK
2022/06/20 12:18:24.664 OK
2022/06/20 12:18:24.664 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.665 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(28,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(28,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(28, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(28, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(28,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(28,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(28,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(28,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(28,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(28,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax28.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(28,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(28,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(28,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(28,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(28,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(28,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(28,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(28,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(28,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax28.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax28.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax28.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax28.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax28.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(28,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(28,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(28,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(28,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(28,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(28,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(28,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(28,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(28,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(28,100)"
ecmcConfigOrDie "Cf2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 OK
2022/06/20 12:18:24.666 ecmcMotorRecord:: setIntegerParam(28 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.666 ecmcMotorRecord:: setDoubleParam(28 motorPowerOnDelay_)=6
2022/06/20 12:18:24.666 ecmcMotorRecord:: setDoubleParam(28 motorPowerOffDelay_=-1
2022/06/20 12:18:24.666 ecmcMotorRecord:: connected(28)
2022/06/20 12:18:24.666 ecmcMotorRecord:: initialPoll(28) status=0
g.SetAxisSoftLimitPosBwd(28,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(28,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(28,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(28,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(28,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(28,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(28,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(28, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(28, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "28", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis28, MOTOR_PORT=MCU1, AXIS_NO=28, DESC=MCU1025 Center Position (28), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis28, MOTOR_PORT=MCU1, AXIS_NO=28,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis28,AXIS_NO=28,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis28,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "29")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=29)
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis29")
epicsEnvSet("ECMC_R",                     "Axis29-")
epicsEnvSet("ECMC_AXIS_NO",               "29")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (29)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE2022/06/20 12:18:24.671 OK
2022/06/20 12:18:24.671 OK
2022/06/20 12:18:24.671 OK
2022/06/20 12:18:24.671 OK
2022/06/20 12:18:24.671 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.672 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
2022/06/20 12:18:24.673 OK
_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(29,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(29,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(29, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(29, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(29,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(29,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(29,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(29,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(29,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(29,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax29.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(29,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(29,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(29,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(29,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(29,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(29,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(29,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(29,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(29,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax29.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax29.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax29.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax29.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax29.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(29,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(29,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(29,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(29,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(29,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(29,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(29,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(29,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(29,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(29,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(29,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(29,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(29,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(29,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(29,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(29,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(29,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(29, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(29, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.2022/06/20 12:18:24.673 ecmcMotorRecord:: setIntegerParam(29 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.673 ecmcMotorRecord:: setDoubleParam(29 motorPowerOnDelay_)=6
2022/06/20 12:18:24.673 ecmcMotorRecord:: setDoubleParam(29 motorPowerOffDelay_=-1
2022/06/20 12:18:24.673 ecmcMotorRecord:: connected(29)
2022/06/20 12:18:24.673 ecmcMotorRecord:: initialPoll(29) status=0
cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "29", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis29, MOTOR_PORT=MCU1, AXIS_NO=29, DESC=MCU1025 Center Position (29), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis29, MOTOR_PORT=MCU1, AXIS_NO=29,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis29,AXIS_NO=29,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis29,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
epicsEnvSet("ID",       "30")
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/configureVirtualAxis.cmd, CONFIG=./cfg/linear.vax, ID=30
#==============================================================================
# configureVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
iocshLoad ./cfg/linear.vax
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis30")
epicsEnvSet("ECMC_R",                     "Axis30-")
epicsEnvSet("ECMC_AXIS_NO",               "30")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Center Position (30)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "1")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "1")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "0")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                        # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                        # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s2.ZERO")              # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")                         # Error 0 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")                         # Error 1 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")                         # Error 2 (if no encoder error bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s2.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s2.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s2.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s2.ONE.0")           #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_E2022/06/20 12:18:24.678 OK
2022/06/20 12:18:24.679 OK
2022/06/20 12:18:24.679 OK
2022/06/20 12:18:24.679 OK
2022/06/20 12:18:24.679 OK
NA",       "0")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.3")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "200.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/addVirtualAxis.cmd
#==============================================================================
# addVirtualAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis-records.cmd
#==============================================================================
# ecmc_virt_axis-records.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd",1)
iocshLoad( /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis.cmd )
#==============================================================================
# ecmc_virt_axis.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_NUM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/verifyOrDie.cmd "EXPR_STR='abs(1)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 1...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(1)<>0","# ECMC_ENC_SCALE_DENOM value OK == 1...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 1...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(30,2,0,0)"
ecmcConfigOrDie "Cfg.SetAxisTrajStartPos(30,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange(30, 0)"
ecmcConfigOrDie "Cfg.SetAxisModType(30, 0)"
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/issueWarning.cmd "EXPR_STR='0.1>0',WARNING_STR='WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..'"
#===================================================================2022/06/20 12:18:24.679 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.680 OK
2022/06/20 12:18:24.681 OK
2022/06/20 12:18:24.681 OK
2022/06/20 12:18:24.681 OK
2022/06/20 12:18:24.681 OK
2022/06/20 12:18:24.681 OK
2022/06/20 12:18:24.681 ecmcMotorRecord:: setIntegerParam(30 motorPowerAutoOnOff_)=2
2022/06/20 12:18:24.681 ecmcMotorRecord:: setDoubleParam(30 motorPowerOnDelay_)=6
2022/06/20 12:18:24.681 ecmcMotorRecord:: setDoubleParam(30 motorPowerOffDelay_=-1
2022/06/20 12:18:24.681 ecmcMotorRecord:: connected(30)
2022/06/20 12:18:24.681 ecmcMotorRecord:: initialPoll(30) status=0
===========
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"0.1>0","", "#-")
############## WARNING ##################################################
 # WARNING: ECMC_ACCL setting is deprecated. Please use ECMC_ACCS_EGU_PER_S2 instead..
#########################################################################
epicsEnvUnset(ECMC_EXE_CMD)
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCL,"'0.1'!='EMPTY'","", "#-")
ecmcEpicsEnvSetCalcTernary(ECMC_BLOCK_ACCS,"'0.1'=='EMPTY'","", "#-")
 ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(30,5.0,0.1)"
ecmcConfigOrDie "Cfg.SetAxisJerk(30,0)"
ecmcConfigOrDie "Cfg.SetAxisVel(30,5.0)"
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(30,0.1)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelTowardsCam(30,5)"
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(30,4)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ZERO,"ax30.enc.actpos")"
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(30,1)"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(30,1)"
ecmcConfigOrDie "Cfg.SetAxisEncType(30,1)"
ecmcConfigOrDie "Cfg.SetAxisEncBits(30,0)"
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(30,0)"
ecmcConfigOrDie "Cfg.SetAxisEncOffset(30,0)"
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(30,100)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(30,1)"
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(30,0)"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.enc.reset")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.enc.alarm0")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.enc.alarm1")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.enc.alarm2")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.enc.warning")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.enc.latchpos")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.enc.latchcontrol")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax30.enc.latchstatus")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax30.mon.lowlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax30.mon.highlim")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax30.mon.homesensor")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s2.ONE.0,"ax30.mon.extinterlock")"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(30,0.3)"
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(30,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(30,1)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(30,0.5)"
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(30,100)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(30,0)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(30,200.0)"
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(30,1)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(30,200)"
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(30,100)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(30,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(30,1)"
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(30,0)"
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(30,1)"
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(30,0)"
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(30,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePosition(30,0.0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(30, 0)"
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(30, 0)"
 ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd",1)
 iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_axis_mr.cmd
#==============================================================================
# ecmc_axis_mr.cmd
ecmcMotorRecordCreateAxis(MCU1, "30", "6", )
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(1)>0){RESULT:=abs(1);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
 dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis30, MOTOR_PORT=MCU1, AXIS_NO=30, DESC=MCU1025 Center Position (30), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.3, DLLM=0, DHLM=0, HOMEPROC=3,SREV=1,UREV=1.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.templa2022/06/20 12:18:24.684 OK
2022/06/20 12:18:24.684 OK
2022/06/20 12:18:24.684 OK
te,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_MTCA:, MOTOR_NAME=Axis30, MOTOR_PORT=MCU1, AXIS_NO=30,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
epicsEnvUnset(ECMC_BLOCK_ACCL)
epicsEnvUnset(ECMC_BLOCK_ACCS)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_MTCA:,AXIS_NAME=Axis30,AXIS_NO=30,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_MTCA:,AXIS_NAME=Axis30,AXIS_TYPE=2")
ecmcFileExist(/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd,1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/ecmc_virt_axis_unset.cmd
#==============================================================================
# ecmc_virt_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_ACCS_EGU_PER_S2)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_MRES)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvUnset(ECMC_TRAJ_TYPE)
epicsEnvUnset(ECMC_JERK)
# reset PREFIX
epicsEnvSet("ECMC_PREFIX"      "IOC_MTCA:")
##############################################################################
## Configure diagnostics:
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
##############################################################################
## go active
iocshLoad (/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/setAppMode.cmd)
#==============================================================================
# setAppMode.cmd
ecmcFileExist("/home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/general.cmd",1)
iocshLoad /home/anderssandstrom/sources/e3-ecmccfg/cellMods/base-7.0.6.1/require-4.0.0/ecmccfg/ruckig/general.cmd
#==============================================================================
# general.cmd
ecmcFileExist("ecmcGeneral.db",1,1)
dbLoadRecords("ecmcGeneral.db","P=IOC_MTCA:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2,ECMC_PROC_HOOK=")
# Examples of commands for info:
# ecmcReport <level> or asynReport <level>
# ecmcReport 3
# ecmcGrepParam <pat2022/06/20 12:18:24.691 INFO: Locking memory
2022/06/20 12:18:24.702 Starting up EtherCAT bus: 0 second(s). Max wait time 30 second(s).
2022/06/20 12:18:24.786 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 2: Not operational (0x24011).
2022/06/20 12:18:24.786 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/06/20 12:18:24.786 ecmc::  Ax     PosSet     PosAct     PosErr    PosTarg   DistLeft    CntrOut   VelFFSet     VelAct   VelFFRaw VelRaw  Error Co CD St IL LI TS ES En Ex Bu Ta Hd L- L+ Ho
2022/06/20 12:18:24.786 ecmc::  30      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0      0  0  0  0 16  0  0  0 00  0  0  0  1  1  1  1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(1) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(1) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(1) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(1) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000023
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(2) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(2) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(2) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(2) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000014
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(2) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(3) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(3) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(3) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(3) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000059
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(3) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(4) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(4) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(4) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(4) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000015
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(4) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(5) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(5) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(5) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(5) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(5) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(6) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(6) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(6) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(6) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000015
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(6) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(7) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(7) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(7) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(7) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000021
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(7) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(8) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(8) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(8) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(8) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(8) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(9) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(9) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(9) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(9) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(9) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(10) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(10) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(10) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(10) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(10) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(11) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(11) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(11) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(11) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(11) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(12) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(12) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(12) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(12) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000012
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(12) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(13) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(13) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(13) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(13) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(13) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(14) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(14) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(14) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(14) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000019
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(14) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(15) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(15) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(15) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(15) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000017
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(15) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(16) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(16) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(16) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(16) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(16) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(17) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(17) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(17) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(17) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000012
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(17) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(18) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(18) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(18) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(18) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(18) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(19) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(19) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(19) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(19) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000018
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(19) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(20) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(20) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(20) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(20) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000015
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(20) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(21) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(21) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(21) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(21) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000015
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(21) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(22) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(22) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(22) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(22) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000016
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(22) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(23) homed=1
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(23) LLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(23) HLS=0
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(23) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000017
2022/06/20 12:18:24.849 ecmcMotorRecord:: poll(23) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(24) homed=1
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(24) LLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(24) HLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(24) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000016
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(24) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(25) homed=1
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(25) LLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(25) HLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(25) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000018
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(25) callParamCallbacksUpdateError Error=0 old=4 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(26) homed=1
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(26) LLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(26) HLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(26) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000014
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(26) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(26) callParamCallbacksUpdateError Error=0 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(27) homed=1
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(27) LLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(27) HLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(27) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(27) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(27) callParamCallbacksUpdateError Error=0 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(28) homed=1
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(28) LLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(28) HLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(28) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000042
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(28) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(28) callParamCallbacksUpdateError Error=0 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(29) homed=1
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(29) LLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(29) HLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(29) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000015
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(29) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(29) callParamCallbacksUpdateError Error=0 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(30) homed=1
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(30) LLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(30) HLS=0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(30) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000021
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(30) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/06/20 12:18:24.850 ecmcMotorRecord:: poll(30) callParamCallbacksUpdateError Error=0 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
2022/06/20 12:18:24.887 ecmc::  30      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0      0  0  0  0 16 16  0  0 00  0  0  0  1  1  1  1
2022/06/20 12:18:24.888 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/06/20 12:18:24.988 ecmc::  30      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0      0  0  0  0  0 16  0  0 00  0  0  1  1  1  1  1
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(1) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000002
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(2) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(3) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(4) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(5) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(6) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(7) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(8) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(9) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(10) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(11) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(12) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(13) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(14) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(15) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(16) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(17) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(18) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(19) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(20) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(21) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(22) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(23) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(24) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(25) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(26) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(27) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(28) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(29) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
2022/06/20 12:18:25.050 ecmcMotorRecord:: poll(30) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000001
